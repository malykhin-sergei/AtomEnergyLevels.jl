<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>AtomEnergyLevels.jl · AtomEnergyLevels</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">AtomEnergyLevels</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>AtomEnergyLevels.jl</a><ul class="internal"><li><a class="tocitem" href="#Theory"><span>Theory</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>AtomEnergyLevels.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>AtomEnergyLevels.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/malykhin-sergei/AtomEnergyLevels.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="AtomEnergyLevels.jl"><a class="docs-heading-anchor" href="#AtomEnergyLevels.jl">AtomEnergyLevels.jl</a><a id="AtomEnergyLevels.jl-1"></a><a class="docs-heading-anchor-permalink" href="#AtomEnergyLevels.jl" title="Permalink"></a></h1><p>Solve numerically</p><ol><li>1D <a href="https://en.wikipedia.org/wiki/Schr%C3%B6dinger_equation">Schrödinger equation</a> by the <a href="https://en.wikipedia.org/wiki/Collocation_method">spectral collocation (i.e., pseudospectral) method</a></li><li>Schrödinger equation for the <a href="https://en.wikipedia.org/wiki/Particle_in_a_spherically_symmetric_potential">particle in a spherically symmetric potential</a></li><li><a href="https://en.wikipedia.org/wiki/Kohn%E2%80%93Sham_equations">Kohn-Sham equation</a> for an atom using <a href="https://en.wikipedia.org/wiki/Local-density_approximation">local-density approximation (LDA)</a></li></ol><h2 id="Theory"><a class="docs-heading-anchor" href="#Theory">Theory</a><a id="Theory-1"></a><a class="docs-heading-anchor-permalink" href="#Theory" title="Permalink"></a></h2><h3 id="Change-of-variables"><a class="docs-heading-anchor" href="#Change-of-variables">Change of variables</a><a id="Change-of-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Change-of-variables" title="Permalink"></a></h3><p>The dynamics of a particle in a spherically symmetric potential are governed  by a Hamiltonian of the following form:</p><p class="math-container">\[-\frac{\hbar^{2}}{2\mu}\underset{\Delta R_{nl}}{\underbrace{\left[\frac{1}{r^{2}}\frac{\partial}{\partial r}\left(r^{2}\frac{\partial R_{nl}}{\partial r}\right)-\frac{l(l+1)}{r^{2}}R_{nl}(r)\right]}}+V(r)R_{nl}(r)=E_{nl}R_{nl}(r)\]</p><p>where <span>$\Delta$</span> - <a href="https://en.wikipedia.org/wiki/Laplace_operator">Laplace operator</a>, <span>$r$</span> - distance between the particle and a defined center point (nucleus), <span>$\mu$</span> - <a href="https://en.wikipedia.org/wiki/Reduced_mass">reduced mass</a>, <span>$R_{nl}(r)$</span> - radial part of a wavefunction,  <span>$E_{nl}$</span> - eigenstate of a system (energy level). The eigenfunctions take the form</p><p class="math-container">\[\psi(r,\,\theta,\,\phi)=R_{nl}(r)\cdot Y_{lm}(\theta,\,\phi)\]</p><p>where <span>$Y_{lm}(\theta,\,\phi)$</span> - <a href="https://en.wikipedia.org/wiki/Spherical_harmonics">spherical harmonic.</a></p><p>The substitution</p><p class="math-container">\[R_{nl}(r)=\frac{1}{r}P_{nl}(r)\]</p><p>results in Schrödinger equation of the form:</p><p class="math-container">\[-\frac{\hbar^{2}}{2m}\left[\frac{\partial^{2}P_{nl}}{\partial r^{2}}-\frac{l(l+1)}{r^{2}}P_{nl}(r)\right]+V(r)P_{nl}(r)=E_{nl}P_{nl}(r)\]</p><p>To solve the latter equation the variable <span>$r$</span> and eigenfunction <span>$P_{nl}(r)$</span> are changed to <span>$x$</span> and <span>$y_{nl}(x)$</span>, where</p><p class="math-container">\[\begin{aligned}
r &amp;= e^{x}\\
y_{nl}(x) &amp;= \frac{1}{\sqrt{r}}P_{nl}\left(r(x)\right)
\end{aligned}\]</p><p>After that, radial Schrödinger equation takes convenient form for numerical solution.</p><p class="math-container">\[-\frac{1}{2\mu}\frac{\partial^{2}y_{nl}(x)}{\partial x^{2}}+\left(\frac{1}{2\mu}\left(l+\frac{1}{2}\right)^{2}+r^{2}V(r)\right)y_{nl}(x)=r^{2}E_{nl}y_{nl}(x)\]</p><p><a href="https://en.wikipedia.org/wiki/Hartree_atomic_units">Atomic units</a> are used  throughout, i.e. <span>$\hbar = 1$</span> and <span>$4\pi\epsilon_0 = 1$</span>. It means that distances are in <span>$1\,a.\!u. = 0.529177\,\AA$</span> and coulomb potential is</p><p class="math-container">\[V(r) = -\frac{Z}{\epsilon r}\]</p><h3 id="Pseudospectral-method"><a class="docs-heading-anchor" href="#Pseudospectral-method">Pseudospectral method</a><a id="Pseudospectral-method-1"></a><a class="docs-heading-anchor-permalink" href="#Pseudospectral-method" title="Permalink"></a></h3><p><a href="https://en.wikipedia.org/wiki/Collocation_method">Pseudospectral method</a> is convenient approach to code a solution of differential equation. The wavefunction is taken as a linear combination of <a href="https://en.wikipedia.org/wiki/Sinc_function">sinc-functions.</a></p><p class="math-container">\[\begin{aligned}
y(x) &amp;= \sum_{i=1}^{n}c_{i}\phi_{i}(x)\\
\phi_{i}(x) &amp;= \frac{\sin\left(\pi(x-x_{i})/h\right)}{\pi(x-x_{i})/h}
\end{aligned}\]</p><p>Discrete grid</p><p class="math-container">\[x_{i}=x_{min}+i\cdot h\]</p><p>where <span>$i=1\ldots n$</span> and step size <span>$h$</span>, defines basis set, since</p><p class="math-container">\[\phi_{i}(x_{j})=\left\{ \begin{array}{clr}
1 &amp; \text{for} &amp; i=j\\
0 &amp; \text{for} &amp; i\neq j
\end{array}\right.\]</p><p>Coefficients are values of the function on a grid.</p><p class="math-container">\[c_i = y(x_i)\]</p><p>The first derivative of a basis function taken on a grid point is</p><p class="math-container">\[\phi&#39;_j(x_i)=\frac{1}{h}\frac{(-1)^i}{i}\]</p><p>Therefore, differentiation of a function on the grid <span>$x_i$</span> is equivalent to matrix-vector product</p><p class="math-container">\[\mathrm{y&#39;(x_i)} = \mathrm{D^{(1)}} \cdot \mathrm{y(x_i)}\]</p><p>where matrices for the first and second derivatives are</p><p class="math-container">\[\mathrm{D^{(1)}}=\frac{1}{h}\left(\begin{array}{ccccc}
0 &amp; 1 &amp; -\frac{1}{2} &amp; \cdots &amp; \frac{(-1)^{n}}{n-1}\\
-1 &amp; 0 &amp; 1\\
\frac{1}{2} &amp; -1 &amp; 0 &amp;  &amp; -\frac{1}{2}\\
 &amp;  &amp;  &amp; \ddots &amp; 1\\
\frac{(-1)^{n-1}}{n-1} &amp; \cdots &amp; \frac{1}{2} &amp; -1 &amp; 0
\end{array}\right)\]</p><p class="math-container">\[\mathrm{D^{(2)}}=\frac{1}{h^{2}}\left(\begin{array}{ccccc}
-\frac{\pi^{2}}{3} &amp; 2 &amp; -\frac{1}{2} &amp; \cdots &amp; \frac{2(-1)^{n}}{(n-1)^{2}}\\
2 &amp; -\frac{\pi^{2}}{3} &amp; 2\\
-\frac{1}{2} &amp; 2 &amp; -\frac{\pi^{2}}{3} &amp;  &amp; -\frac{1}{2}\\
 &amp;  &amp;  &amp; \ddots &amp; 2\\
\frac{2(-1)^{n}}{(n-1)^{2}} &amp; \cdots &amp; -\frac{1}{2} &amp; 2 &amp; -\frac{\pi^{2}}{3}
\end{array}\right)\]</p><p>With these matrices, the numerical solution of Schrödinger equation becomes  a linear algebra problem. For this we have the following ingredients:</p><ol><li>logarithmic grid <span>$r_i=\exp(x_i)$</span> on which vectors are calculated: orbitals <span>$y_k$</span> and potential <span>$V(r)$</span>,</li><li>diagonal matrices: <span>$\mathrm{S} = r_i^2$</span> and <span>$\mathrm{V_{\text{eff}}}=\frac{1}{2\mu}\left(l+\frac{1}{2}\right)^{2}+r_i^{2}V(r_i)$</span>,  </li><li>kinetic energy operator <span>$\mathrm{K}=-\frac{1}{2\mu}\cdot D^{(2)}$</span>,</li><li>Hamiltonian operator <span>$\mathrm{H = K + V_{\text{eff}}}$</span>.</li></ol><p>Variants of this approach can be found in the documentation  <a href="http://appliedmaths.sun.ac.za/~weideman/research/differ.html">A Matlab Differentiation Matrix Suite.</a></p><h3 id="Peculiarities-of-the-eigenvalue-problem"><a class="docs-heading-anchor" href="#Peculiarities-of-the-eigenvalue-problem">Peculiarities of the eigenvalue problem</a><a id="Peculiarities-of-the-eigenvalue-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Peculiarities-of-the-eigenvalue-problem" title="Permalink"></a></h3><p>Solution of the <a href="https://en.wikipedia.org/wiki/Eigendecomposition_of_a_matrix">eigenvalues problem</a>  is pairs of eigenvectors <span>$\epsilon_k$</span> and eigenvectors <span>$y_k$</span>,  that correspond to the particle&#39;s energy levels and wavefunctions (orbitals).  The <span>$i$</span> component of the <span>$y_k$</span> eigenvector is the value of the <span>$k$</span> level  wavefunction at the <span>$x_i$</span> grid point. It is this property of the  pseudospectral method that makes the algorithm compact and clear.</p><p class="math-container">\[\mathrm{H\cdot y = S\cdot y}\]</p><p>The <a href="https://en.wikipedia.org/wiki/Eigendecomposition_of_a_matrix#Generalized_eigenvalue_problem">generalized eigenvalue problem</a> of eigenvalues of a symmetrical matrix <span>$H$</span> and a symmetrical,  positively defined matrix <span>$S$</span> is reduced to the symmetrical eigenvalues  problem using the <a href="https://doi.org/10.1016/S0065-3276(08)60339-1">symmetrical Lövdin orthogonalization.</a></p><p class="math-container">\[\mathrm{\underset{H&#39;}{\underbrace{S^{-\frac{1}{2}}\cdot H\cdot S^{-\frac{1}{2}}}}\cdot\underset{y&#39;}{\underbrace{S^{\frac{1}{2}}\cdot y}}=E\cdot\underset{y&#39;}{\underbrace{S^{\frac{1}{2}}\cdot y}}}\]</p><p>where </p><p class="math-container">\[\mathrm{H&#39;}=\left(\begin{array}{cccc}
\frac{H_{11}}{r_{1}r_{1}} &amp; \frac{H_{12}}{r_{1}r_{2}} &amp; \cdots &amp; \frac{H_{1n}}{r_{1}r_{n}}\\
\frac{H_{21}}{r_{2}r_{1}} &amp; \frac{H_{22}}{r_{2}^{2}} &amp;  &amp; \vdots\\
\vdots &amp;  &amp; \ddots\\
\frac{H_{n1}}{r_{n}r_{1}} &amp; \cdots &amp;  &amp; \frac{H_{nn}}{r_{n}^{2}}
\end{array}\right)\]</p><p>However, the floating point representation of numbers leads to a loss of  symmetry of the matrix <span>$H&#39;$</span> due to non-associativity.</p><p class="math-container">\[H_{ij}/r_i/r_j \neq H_{ji}/r_j/r_i\]</p><p><a href="http://www.netlib.org/lapack/lug/node54.html">The standard algorithm implemented in the LAPACK library</a>  for the generalized eigenvalue problem uses the <a href="https://en.wikipedia.org/wiki/Cholesky_decomposition">Cholesky decomposition</a>,  but its scope <a href="http://www.netlib.org/utk/people/JackDongarra/etemplates/node177.html#sec:gsym_pert">is limited</a>  to the case when the <span>$\mathrm{S}$</span> matrix is well defined, i.e.  condition number</p><p class="math-container">\[k(\mathrm{S})\equiv\left\Vert \mathrm{S}\right\Vert _{2}\cdot\left\Vert \mathrm{S}^{-1}\right\Vert _{2}\]</p><p>is not large. In our case, this number is very large, ca <span>$10^{52}$</span></p><p class="math-container">\[k(\mathrm{S})=\sqrt{\sum_{i}r_{i}^{2}}\cdot\sqrt{\sum_{i}\frac{1}{r_{i}^{2}}}&gt;\frac{r_{max}}{r_{min}}\]</p><p>To remedy the problem, note that eigenvalues of <a href="https://en.wikipedia.org/wiki/Matrix_pencil">matrix pencils</a> <span>$(\mathrm{H,S})$</span> and <span>$(\mathrm{H,\alpha S + \beta H})$</span> are same, when matrix <span>$\mathrm{\alpha S + \beta H}$</span> is positive definite. Then</p><p class="math-container">\[\mathrm{H \cdot y = \theta \cdot (\alpha S + \beta H) \cdot y}\]</p><p>has eigenvalues</p><p class="math-container">\[\theta_i = \frac{\epsilon_i}{\alpha + \beta \epsilon_i}\]</p><p>Setting <span>$\beta = 1$</span> and <span>$\alpha = 10^5$</span> we make new matrix</p><p class="math-container">\[\mathrm{S&#39; = \alpha S + H}\]</p><p>which is positive definite and well-conditioned, then solve</p><p class="math-container">\[\mathrm{H \cdot y = \theta \cdot S&#39; \cdot y}\]</p><p>using standard LAPACK routine. Eigenvalues of interest are found with</p><p class="math-container">\[\epsilon_i = \frac{\alpha \cdot \theta_i}{1 - \theta_i}\]</p><p>This approach is used here.</p><h3 id="Sketch-of-the-solution"><a class="docs-heading-anchor" href="#Sketch-of-the-solution">Sketch of the solution</a><a id="Sketch-of-the-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Sketch-of-the-solution" title="Permalink"></a></h3><p>We are going to find a solution of the differential equation</p><p class="math-container">\[-\frac{1}{2\mu}\frac{\partial^{2}y_{nl}(x)}{\partial x^{2}}+\left(\frac{1}{2\mu}\left(l+\frac{1}{2}\right)^{2}+r^{2}V(r)\right)y_{nl}(x)=r^{2}E_{nl}y_{nl}(x)\]</p><p>on the grid <span>$x_i = x_{min} + (i-1)\cdot dx$</span>. </p><pre><code class="language-julia">using LinearAlgebra

# find differentiation matrix
function laplacian(x)
  n, h = length(x), step(x)
  Δ = Matrix{Float64}(undef, n, n)
  Δ[diagind(Δ, 0)] .= -1/3 * π^2 / h^2
  for i = 2:n
    Δ[diagind(Δ, i - 1)] =
    Δ[diagind(Δ, 1 - i)] .= 2 * (-1)^i / (i - 1)^2 / h^2
  end
  return Δ
end

# make logarithmic grid on r
x = -30.0:0.175:5.0; r = exp.(x); r² = exp.(2x)

# set up parameters of the hydrogen atom hamiltonian:
# reduced mass, azimuthal quantum number, and nucleus charge
μ = 1; l = 0; Z = 1;

# make hamiltonian matrix
H = -1/2μ*laplacian(x) + Diagonal(1/2μ * (l + 1/2)^2 .- Z*r);

# form positive definite well-conditioned matrix S
α = 1e5; β = 1;
S = β*H + α * Diagonal(r .* r);

# solve generalized eigenproblem
θ, y = eigen(H, S);
ϵ = α * θ ./ (1.0 .- θ);

# see energy of the 1s-state of hydrogen atom
ϵ[1]</code></pre><pre class="documenter-example-output">-0.49999999997186934</pre></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 30 November 2020 17:13">Monday 30 November 2020</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
