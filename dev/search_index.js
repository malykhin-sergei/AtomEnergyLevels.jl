var documenterSearchIndex = {"docs":
[{"location":"#AtomEnergyLevels.jl","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Solve numerically","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"1D Schrödinger equation by the spectral collocation (i.e., pseudospectral) method\nSchrödinger equation for the particle in a spherically symmetric potential\nKohn-Sham equation for an atom using local-density approximation (LDA)","category":"page"},{"location":"#Theory","page":"AtomEnergyLevels.jl","title":"Theory","text":"","category":"section"},{"location":"#Change-of-variables","page":"AtomEnergyLevels.jl","title":"Change of variables","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"The dynamics of a particle in a spherically symmetric potential are governed by a Hamiltonian of the following form:","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"-frachbar^22muundersetDelta R_nlunderbraceleftfrac1r^2fracpartialpartial rleft(r^2fracpartial R_nlpartial rright)-fracl(l+1)r^2R_nl(r)right+V(r)R_nl(r)=E_nlR_nl(r)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where Delta - Laplace operator, r - distance between the particle and a defined center point (nucleus), mu - reduced mass, R_nl(r) - radial part of a wavefunction, E_nl - eigenstate of a system (energy level). The eigenfunctions are","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"psi(rthetaphi)=R_nl(r)cdot Y_lm(thetaphi)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where Y_lm(thetaphi) - spherical harmonic.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"The substitution","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"R_nl(r)=frac1rP_nl(r)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"can be used to write the radial Schrödinger equation as:","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"-frachbar^22mleftfracpartial^2P_nlpartial r^2-fracl(l+1)r^2P_nl(r)right+V(r)P_nl(r)=E_nlP_nl(r)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Variable r and eigenfunction P_nl(r) can be changed to x and y_nl(x) for the convenience of numerical solution.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"beginaligned\nr = e^x\ny_nl(x) = frac1sqrtrP_nlleft(r(x)right)\nendaligned","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"After that, the radial Schrödinger equation is following.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"-frac12mufracpartial^2y_nl(x)partial x^2+left(frac12muleft(l+frac12right)^2+r^2V(r)right)y_nl(x)=r^2E_nly_nl(x)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"in Atomic units,  as we use throughout, i.e. hbar = 1 and 4piepsilon_0 = 1.  It means that distances are in 1 a.u. = 0.529177 Angstrom and Coulomb  potential is","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"V(r) = -fracZepsilon r","category":"page"},{"location":"#Pseudospectral-method","page":"AtomEnergyLevels.jl","title":"Pseudospectral method","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Pseudospectral method is convenient approach to code a solution of differential equation. The wavefunction is taken as a linear combination of basis sinc-functions.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"beginaligned\ny(x) = sum_i=1^nc_iphi_i(x)\nphi_i(x) = fracsinleft(pi(x-x_i)hright)pi(x-x_i)h\nendaligned","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Discrete grid","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"x_i=x_min+icdot h","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where i=1ldots n and step size h, defines basis set, since","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"phi_i(x_j)=left beginarrayclr\n1  textfor  i=j\n0  textfor  ineq j\nendarrayright","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"coefficients are values of the function on a grid.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"c_i = y(x_i)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"The first derivative of a basis function taken on a grid point is","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"phi_j(x_i)=frac1hfrac(-1)^ii","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Therefore, differentiation of a function on the grid x_i is equivalent to matrix-vector product","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"mathrmy(x_i) = mathrmD^(1) cdot mathrmy(x_i)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where matrices for the first and second derivatives are","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"mathrmD^(1)=frac1hleft(beginarrayccccc\n0  1  -frac12  cdots  frac(-1)^nn-1\n-1  0  1\nfrac12  -1  0    -frac12\n      ddots  1\nfrac(-1)^n-1n-1  cdots  frac12  -1  0\nendarrayright)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"mathrmD^(2)=frac1h^2left(beginarrayccccc\n-fracpi^23  2  -frac12  cdots  frac2(-1)^n(n-1)^2\n2  -fracpi^23  2\n-frac12  2  -fracpi^23    -frac12\n      ddots  2\nfrac2(-1)^n(n-1)^2  cdots  -frac12  2  -fracpi^23\nendarrayright)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"With these matrices, a numerical solution of Schrödinger equation becomes a linear algebra problem. For this to be done, we have the following ingredients:","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"logarithmic grid x_i = ln(r_i) on which vectors are calculated: orbitals y_k and potential V(r),\ndiagonal matrices: mathrmS = r_i^2 and mathrmV_texteff=frac12muleft(l+frac12right)^2+r_i^2V(r_i),  \nkinetic energy operator mathrmK=-frac12mucdot D^(2),\nhamiltonian operator mathrmH = K + V_texteff.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Variants of this approach can be found in the documentation A Matlab Differentiation Matrix Suite.","category":"page"},{"location":"#Peculiarities-of-the-eigenvalue-problem","page":"AtomEnergyLevels.jl","title":"Peculiarities of the eigenvalue problem","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Solution of the eigenvalues problem is pairs of eigenvectors epsilon_k and eigenvectors y_k, that correspond to the particle's energy levels and wavefunctions (orbitals). The i component of the y_k eigenvector is the value of the k level wavefunction at the x_i grid point. It is this property of the pseudospectral method that makes the algorithm compact and clear.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"mathrmHcdot y = Scdot y","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"The generalized eigenvalue problem of eigenvalues of a symmetrical matrix H and a symmetrical, positively defined matrix S can be reduced to the symmetrical eigenvalues problem using the symmetrical Löwdin orthogonalization.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"mathrmundersetHunderbraceS^-frac12cdot Hcdot S^-frac12cdotundersetyunderbraceS^frac12cdot y=EcdotundersetyunderbraceS^frac12cdot y","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"mathrmH=left(beginarraycccc\nfracH_11r_1r_1  fracH_12r_1r_2  cdots  fracH_1nr_1r_n\nfracH_21r_2r_1  fracH_22r_2^2    vdots\nvdots    ddots\nfracH_n1r_nr_1  cdots    fracH_nnr_n^2\nendarrayright)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"However, the floating point representation of numbers leads to symmetry loss of the matrix H due to non-associativity.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"H_ijr_ir_j neq H_jir_jr_i","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"The standard algorithm implemented in the LAPACK library for the generalized eigenvalue problem uses the Cholesky decomposition, but its scope is limited to the case when mathrmS matrix is well defined, i.e. condition number","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"k(mathrmS)equivleftVert mathrmSrightVert _2cdotleftVert mathrmS^-1rightVert _2","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"is not large. In our case, this number is very large, ca 10^52","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"k(mathrmS)=sqrtsum_ir_i^2cdotsqrtsum_ifrac1r_i^2fracr_maxr_min","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"To remedy the problem, note that eigenvectors of matrix pencils (mathrmHS) and (mathrmHalpha S + beta H) are same, when matrix mathrmalpha S + beta H is positive definite. Then","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"mathrmH cdot y = theta cdot (alpha S + beta H) cdot y","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"has eigenvalues","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"theta_i = fracepsilon_ialpha + beta epsilon_i","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Setting beta = 1 and alpha = 10^5 we make new matrix","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"mathrmS = alpha S + H","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"which is positive definite and well-conditioned, then solve the problem","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"mathrmH cdot y = theta cdot S cdot y","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"using standard LAPACK routine. Eigenvalues of interest are found with","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"epsilon_i = fracalpha cdot theta_i1 - theta_i","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"This approach is used in the present code.","category":"page"},{"location":"#Sketch-of-the-solution","page":"AtomEnergyLevels.jl","title":"Sketch of the solution","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"We are going to find a solution of the differential equation","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"-frac12mufracpartial^2y_nl(x)partial x^2+left(frac12muleft(l+frac12right)^2+r^2V(r)right)y_nl(x)=r^2E_nly_nl(x)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"on the grid x_i = x_min + (i-1)cdot dx.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"using LinearAlgebra\n\n# find differentiation matrix\nfunction laplacian(x)\n  n, h = length(x), step(x)\n  Δ = Matrix{Float64}(undef, n, n)\n  Δ[diagind(Δ, 0)] .= -1/3 * π^2 / h^2\n  for i = 2:n\n    Δ[diagind(Δ, i - 1)] =\n    Δ[diagind(Δ, 1 - i)] .= 2 * (-1)^i / (i - 1)^2 / h^2\n  end\n  return Δ\nend\n\n# make logarithmic grid on r\nx = -30.0:0.175:5.0; r = exp.(x); r² = exp.(2x)\n\n# set up parameters of the hydrogen atom hamiltonian:\n# reduced mass, azimuthal quantum number, and nucleus charge\nμ = 1; l = 0; Z = 1;\n\n# make hamiltonian matrix\nH = -1/2μ*laplacian(x) + Diagonal(1/2μ * (l + 1/2)^2 .- Z*r);\n\n# form positive definite well-conditioned matrix S\nα = 1e5; β = 1;\nS = β*H + α * Diagonal(r .* r);\n\n# solve generalized eigenproblem\nθ, y = eigen(H, S);\nϵ = α * θ ./ (1.0 .- θ);\n\n# see energy of the 1s-state of hydrogen atom\nϵ[1]","category":"page"},{"location":"#Schrödinger-equation","page":"AtomEnergyLevels.jl","title":"Schrödinger equation","text":"","category":"section"},{"location":"#Differentiation-matrix","page":"AtomEnergyLevels.jl","title":"Differentiation matrix","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"laplacian","category":"page"},{"location":"#AtomEnergyLevels.laplacian","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.laplacian","text":"laplacian(n::Int, h::Real)\nlaplacian(x::AbstractRange{T}) where {T}\n\nReturns n times n differentiation matrix mathrmD^(2) using sinc interpolants.  See Weideman, J.A., and Reddy, S.C. (2000). A MATLAB differentiation matrix suite.  ACM Transactions on Mathematical Software (TOMS), 26(4), 465-519. Equation (20) on page 485.\n\nOn input: n - size of a uniform grid with step size h, or x - AbstractRange object.\n\nExample\n\nSecond derivative of the gaussian function\n\n    partial^2 exp(-x^2)partial x^2 = 2(2x^2 - 1)exp(-x^2)\n\njulia> x = -6:0.01:6\n-6.0:0.01:6.0\n\njulia> d²f_exact = 2(2x.^2 .- 1).*exp.(-x.^2);\n\njulia> d²f_approx = laplacian(length(x), step(x)) * exp.(-x.^2);\n\njulia> isapprox(d²f_exact, d²f_approx, atol = 1e-10)\ntrue\n\n\n\n\n\n","category":"function"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Using the following code, one can find the vibrational levels of the radical OH⋅, for which the potential energy surface is approximated through the Morse potential.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"using AtomEnergyLevels\nusing LinearAlgebra, Test, Printf\n\n# Morse potential\nV(x, D, β, x₀) = D*(exp(-β*(x-x₀))-1)^2 - D;\n\n# parameters of the O-H bond\nD  = 0.1994;   β = 1.189;  x₀ = 1.821;\nmH = 1.00794; mO = 15.9994; μ = 1822.8885*(mH*mO)/(mH+mO);  \n\n# grid\nx = (2.0 - x₀):0.1:(12.0 + x₀);\n\n# hamiltonian\nH = -1/2μ*laplacian(x) + Diagonal(V.(x, D, β, x₀));\n\n# numerical solution\nϵ, ψ = eigen(H);                      \n\n# exact solution\nω = β*sqrt(2D/μ); δ = ω^2 / 4D;  \nE(n) = ω*(n+1/2) - δ*(n+1/2)^2 - D;\n\n# comparison\nfor i in 1:5\n  @printf \"Level %i: E(exact) = %5.10f E(approx) = %5.10f\\n\" i E(i-1) ϵ[i]\nend","category":"page"},{"location":"#Atomic-electron-configuration-parsing","page":"AtomEnergyLevels.jl","title":"Atomic electron configuration parsing","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"conf_enc","category":"page"},{"location":"#AtomEnergyLevels.conf_enc","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.conf_enc","text":"conf_enc(input::AbstractString; maxn = 7, spins = 2,\nnotation = Dict(\"s\" => 0, \"p\" => 1, \"d\" => 2, \"f\" => 3))\n\nParse an input string as the configuration of an atom. An electronic  configuration is string like \"[He] 2s2 2p1\", where the notation [X] indicates  that all subshells associated with the noble gas X are fully occupied.  The function encodes the configuration provided \"[He] 2s2 2p1\" and returns  ((2.0, 2.0), (1.0,)), where subtuples (2.0, 2.0) and (1.0,) are  populations of all the l = 0 and l = 1 shells, i.e. ((1s², 2s²), (2p¹,)).  Within each subtuple populations of levels with the same azimuthal quantum  number l and subsequent radial quantum numbers nᵣ are listed.\n\nOptional keyword arguments are:\n\nmaxn  - maximal permitted principal quantum number\nspins - number of spin up/spin down electrons per level (1 or 2)\nnotation - dictionary encoding the correspondence of quantum numbers l = 0, 1... to letters: s, p, d... See spectroscopic notation\n\nExamples\n\njulia> conf = conf_enc(\"[Ar] 3d1 4s2\") # Scandium, Z = 21\n((2.0, 2.0, 2.0, 2.0), (6.0, 6.0), (1.0,))\n\njulia> sum(collect(Iterators.flatten(conf)))\n21.0\n\n\n\n\n\n","category":"function"},{"location":"#Radial-Schrödinger-equation-solver","page":"AtomEnergyLevels.jl","title":"Radial Schrödinger equation solver","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"radial_shr_eq","category":"page"},{"location":"#AtomEnergyLevels.radial_shr_eq","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.radial_shr_eq","text":"radial_shr_eq(V::Function = r -> -1/r, x::AbstractRange{T} = -30.0:0.1:5.0;\nconf = 1, μ = 1.0, α = 1e5) where {T}\n\nradial_shr_eq(V::Array{S}, x::AbstractRange{T}; \nconf = 1, μ = 1.0, α = 1e5) where {S, T}\n\nSolve Schrödinger equation (atomic units are assumed)\n\n-frac12muleftfrac1r^2fracpartialpartial rleft(r^2fracpartial R_nlpartial rright)-fracl(l+1)r^2R_nl(r)right+V(r)R_nl(r)=E_nlR_nl(r)\n\nfor the particle in a spherically symmetric potential.\n\nOn input:\n\nV - potential, provided as an explicit function V(r) (by default r -> -1/r), or an array of values on a radial grid.\nx - uniform grid (AbstractRange object), such as r_i = exp(x_i). Default grid is -30.0:0.1:5.0\nconf - electronic configuration of interest, by default: ground state conf = ((1.0),)\nμ - reduced mass, by default μ = 1.0 (electron mass in a.u.)\nα - parameter α = 10^5 is used in the matrix pencil mathrmH + αmathrmS for the generalized eigenproblem.\n\nOn output function returns:\n\nsum of one-particle energies: E = sum_i=1^N n_i epsilon_i\nparticles density: rho(x) = frac14pi sum_i=1^N n_i y_i^2(x)\norbitals y_i(x), corresponding eigenvalues epsilon_i (energy levels), azimuthal and radial quantum numbers l, n_r, and level populations n_i (as listed in conf).\n\nExamples\n\nHydrogen atom\n\njulia> radial_shr_eq(r -> -1/r, conf = conf_enc(\"1s1\")).energy ≈ -1/2\ntrue\n\njulia> radial_shr_eq(r -> -1/r, conf = conf_enc(\"2s1\")).energy ≈ -1/8\ntrue\n\njulia> radial_shr_eq(r -> -1/r, conf = conf_enc(\"2p1\")).energy ≈ -1/8\ntrue\n\njulia> radial_shr_eq(r -> -1/r, conf = conf_enc(\"3s1\")).energy ≈ -1/18\ntrue\n\njulia> radial_shr_eq(r -> -1/r, conf = conf_enc(\"3p1\")).energy ≈ -1/18\ntrue\n\njulia> radial_shr_eq(r -> -1/r, conf = conf_enc(\"3d1\")).energy ≈ -1/18\ntrue\n\n\n\n\n\n","category":"function"},{"location":"#Isotropic-harmonic-oscillator","page":"AtomEnergyLevels.jl","title":"Isotropic harmonic oscillator","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Using the following code, one can find the energy levels for a spherically-symmetric three-dimensional harmonic oscillator.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"To find the energy levels with quantum numbers nᵣ = 0, 1, 2 and l = 0, 1, 2 the levels of interest should be included in the electronic configuration.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"using AtomEnergyLevels, Printf\n\nfunction isotropic_harmonic_oscillator(cfg)\n  ψ = radial_shr_eq(r -> 1/2*r^2, conf = conf_enc(cfg)).orbitals;\n  @printf(\"\\tϵ(calc.)\\tϵ(exact)\\tΔϵ\\n\");\n  for (quantum_numbers, orbital) in sort(collect(ψ), by = x -> last(x).ϵᵢ)\n    nᵣ, l = quantum_numbers\n    ϵ_calc = orbital.ϵᵢ\n    n = nᵣ + l + 1\n    ϵ_exact = 2nᵣ + l + 3/2\n    @printf(\"%i%s\\t%10.8f\\t%10.8f\\t%+0.6e\\n\",\n            n, atomic_shell[l], ϵ_calc, ϵ_exact, ϵ_exact - ϵ_calc)\n  end\nend\n\nisotropic_harmonic_oscillator(\"1s1 2s1 3s1 2p1 3p1 4p1 3d1 4d1 5d1\");","category":"page"},{"location":"#Kratzer-Potential","page":"AtomEnergyLevels.jl","title":"Kratzer Potential","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"using AtomEnergyLevels, Printf\n\n\"\"\"\nSolutions of the Schrödinger Equation for the Kratzer Potential.\nA. Kratzer, \"Die ultraroten Rotationsspektren der Halogenwasserstoffe,\" \nZeitschrift für Physik, 3(5), 1920 pp. 289–307. doi:10.1007/BF01327754\n\nSee also \nhttps://demonstrations.wolfram.com/ExactSolutionsOfTheSchroedingerEquationForTheKratzerPotentia/\n\"\"\"\nfunction kratzer(D, a, levels::Union{UnitRange{Int64}, Int64} = 0)\n    cfg = join(collect(levels) .+ 1, \"s1 \") * \"s1\"\n    ψ = radial_shr_eq(r -> -2D*(a/r - a^2 / 2r^2), \n        conf = conf_enc(cfg, maxn = last(levels) + 1)).orbitals\n    \n    μ = 1/2*sqrt(1 + 8a^2*D)\n\n    @printf(\"\\tϵ(calc.)\\tϵ(exact)\\tΔϵ\\n\");\n    for (quantum_numbers, orbital) in sort(collect(ψ), by = x -> last(x).ϵᵢ)\n      nᵣ, l = quantum_numbers\n      ϵ_calc = orbital.ϵᵢ\n      n = nᵣ + l + 1\n      ϵ_exact = -2a^2 * D^2 / (nᵣ + μ + 1/2)^2\n      @printf(\"%i%s\\t%11.8f\\t%11.8f\\t%+0.6e\\n\",\n              n, atomic_shell[l], ϵ_calc, ϵ_exact, ϵ_exact - ϵ_calc)\n    end    \nend\n\nkratzer(2.5, 1.25, 0:10)","category":"page"},{"location":"#Pseudoharmonic-Potential","page":"AtomEnergyLevels.jl","title":"Pseudoharmonic Potential","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"using AtomEnergyLevels, Printf\n\n\"\"\"\nSolutions of the Schrödinger Equation for Pseudoharmonic Potential.\n\nI.I. Gol'dman and V.D. Krivchenkov, Problems in Quantum Mechanics \n(B. T. Geǐlikman, ed., E. Marquit and E. Lepa, trans.), Reading, MA: Addison-Wesley, 1961.‬\n\nSee also\nhttps://demonstrations.wolfram.com/ExactSolutionsOfTheSchroedingerEquationForPseudoharmonicPote/\n\"\"\"\nfunction pseudoharmonic(D, a, levels::Union{UnitRange{Int64}, Int64} = 0)\n    cfg = join(collect(levels) .+ 1, \"s1 \") * \"s1\"\n    ψ = radial_shr_eq(r -> D*(r/a - a/r)^2, -5.0:0.01:4.0,\n        conf = conf_enc(cfg, maxn = last(levels) + 1)).orbitals\n\n    @printf(\"\\tϵ(calc.)\\tϵ(exact)\\tΔϵ\\n\");\n    for (quantum_numbers, orbital) in sort(collect(ψ), by = x -> last(x).ϵᵢ)\n      nᵣ, l = quantum_numbers\n      ϵ_calc = orbital.ϵᵢ\n      n = nᵣ + l + 1\n      ϵ_exact = sqrt(D/2)/a * (2 + 4nᵣ - 2a * sqrt(2D) + sqrt(1 + 8D * a^2))\n      @printf(\"%i%s\\t%11.8f\\t%11.8f\\t%+0.6e\\n\",\n              n, atomic_shell[l], ϵ_calc, ϵ_exact, ϵ_exact - ϵ_calc)\n    end    \nend\n\npseudoharmonic(1, 2, 0:10)","category":"page"},{"location":"#Kohn-Sham-equations","page":"AtomEnergyLevels.jl","title":"Kohn-Sham equations","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"The Kohn–Sham equations  consist of the radial Schrödinger equation above with an with an effective  potential v_s(r) given by","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"v_s = V_H + V_xc + v_ext","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where V_H is the Hartree potential  given by the solution of the radial Poisson equation, V_xc is the exchange-correlation potential and v_ext is the external potential (most offen electron-nuclear v_ext = -Zr interaction).","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"The total energy is given by:","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"En = T_sn + E_Hn + E_xcn + Vn","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"beginaligned\nT_sn = sum_i epsilon_i -int v_s(bf r)n(bf r)mathrmd^3r\nE_Hn = frac12int V_H(bf r) n(bf r) mathrmd^3r\nE_xcn = int epsilon_xc(bf rn) n(bf r) mathrmd^3r\nVn = int v_ext(bf r) n(bf r) mathrmd^3r\nendaligned","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Summing up all expressions we obtain final formula.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"En = sum_i epsilon_i + int left-frac12V_H(bf r) - V_xc(bf r) + epsilon_xc(bf rn)right n(bf r) mathrmd^3r","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where epsilon_xc(bf rn) is a universal potential fundamentally related to V_xc by ","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"V_xc = fracdnepsilon_xcdn","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Etot = ∑ε + 4π * ∫(dx, ρ_out .* (-1/2 * vh .- vxc .+ εxc) .* r²)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"note: Note\nIt is generally accepted to denote by the letters n - particle density, and rho - charge density. However, this is not convenient in a code. For this reason I have chosen ρ to denote electronic particle density in a code throughout.","category":"page"},{"location":"#Poisson-equation-and-the-Hartree-potential","page":"AtomEnergyLevels.jl","title":"Poisson equation and the Hartree potential","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Coulomb repulsion between electrons is accounted for under the form of an average field v_H (Hartree potential), containing the combined repulsion  from all other electrons on the electron that we are considering.  Hartree potential is however not a true potential, since it depends upon  the charge density distributions of the electrons, that depend in turn upon  the solutions of the Kohn-Sham equations. The equations can be solved in an  iterative way, after an initial guess of the orbitals is assumed.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"In this section we present the algorithm of solution the Poisson equation for the charge distribution rho(bf r) = -n(bf r) with the spherical symmetry. The solution to Poisson's equation is the potential field caused by a given  electric charge density distribution.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Delta v_H(r)=-4pi n(r)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Substituting v_H(r) = fracU(r)r we obtain","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"fracd^2Udr^2=-4pi n(r)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"This is ordinary differential equation of order two, defined on interval 0 infty. In order to solve this equation two boundary conditions are needed. These are U(0) = 0 and U(infty) = Q, where Q - total charge.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"They are Dirichlet boundary conditions,  therefore, exist alpha and beta for tildeU(r) (any solution of differential equation, not necessary fulfilling the boundary conditions) then the function","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"U(r) = tildeU(r) + alpha r + beta","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"is the solution of Poisson equation that fulfills the boundary conditions.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"On the logarithmic grid x = ln(r) the Poisson equation takes form","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"left(fracpartial^2partial x^2-frac14right)v_H(x)=-4pi r^2sqrtrcdot n(x)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where v_H(r) = v_H(x)sqrtr. ","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Again, this equation can easily be solved via pseudospectral approach. On a logarithmic grid r_min plays role of zero, and r_max is practically infinity. A solution taken as","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"v_H(x)=tildev_H(x)-fractildev_H(x_max)-Qsqrtr_maxsqrtr_maxcdot sqrtr-fractildev_H(x_min)-Qcdot sqrtr_minsqrtrcdot sqrtr_min","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where tildev_H(x) - pseudospectral solution, is what we searching for, since","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"v_H(x_min)approx Qcdot sqrtr_min","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"and","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"v_H(x_max) approx Qsqrtr_max","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Here is how it coded.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"# Solve the Poisson equation to obtain Hartree potential\nvh = L \\ (-4π * ρ_in .* sqr .* r)\n# Apply boundary conditions at r → 0 and r → ∞\nvh .-= (vh[n] - Q / sqr[n])/sqr[n] .* sqr .+\n       (vh[1] - Q * sqr[1])*sqr[1] ./ sqr\n# Change variable vh(x) → vh(r)\nvh ./= sqr","category":"page"},{"location":"#Exchange-correlation-potential","page":"AtomEnergyLevels.jl","title":"Exchange-correlation potential","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"An exchange-correlation potential V_xc and exchange-correlation energy density are","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"beginaligned\nV_xc(r)  = V_x(r) + V_c(r)\nepsilon_xc(r)  = epsilon_x(r) + epsilon_c(r)\nendaligned","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"In the local density approximation (LDA) epsilon_x(r) is taken equal to the exchange energy density of the homogeneous electron gas.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"epsilon_x(r) = epsilon_xleftn(r)right = -alpha frac94 left(frac3n(r)8πright)^frac13","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where parameter alpha = 23. Density of the correlation energy of the homogeneous electron gas has not analytic formula, but can be interpolated. For example, one of the most simple expressions is Chachiyo correlation functional.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"epsilon_c(r_s)=a ln left(1 + fracbr_s + fracbr_s^2right)","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where r_s is Wigner-Seitz parameter, related to the density as","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"frac43pi r_s^3 = frac1n","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"and a, b are fitting parameters. For the LDA epsilon_x = frac34 V_x.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"At present, the following LDA functionals are implemented.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"LDA_X\nLDA_C_CHACHIYO\nLDA_C_VWN","category":"page"},{"location":"#AtomEnergyLevels.LDA_X","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.LDA_X","text":"LDA_X(ρ; α = 2/3)\n\nGives Slater's approximation of the exchange energy density  epsilon_x, and potential V_x.\n\nReferences\n\nP. A. M. Dirac, Math. Proc. Cambridge Philos. Soc. 26, 376 (1930) (doi: 10.1017/S0305004100016108)\nF. Bloch, Z. Phys. 57, 545 (1929) (doi: 10.1007/BF01340281)\nJ.C. Slater, Phys. Rev. 81, 385 (1951) (doi: 10.1103/PhysRev.81.385)\n\n\n\n\n\n","category":"function"},{"location":"#AtomEnergyLevels.LDA_C_CHACHIYO","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.LDA_C_CHACHIYO","text":"LDA_C_CHACHIYO(ρ; a  = -0.01554535, b₁ = 20.4562557, b  = 20.4562557)\n\nGives Chachiyo's approximation of the correlation energy density  epsilon_x, and potential V_x.\n\nReferences\n\nT. Chachiyo, J. Chem. Phys. 145, 021101 (2016) (doi: 10.1063/1.4958669)\n\n\n\n\n\n","category":"function"},{"location":"#AtomEnergyLevels.LDA_C_VWN","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.LDA_C_VWN","text":"LDA_C_VWN(ρ; a = 0.0310907, b = 3.72744, c = 12.9352, x0 = -0.10498)\n\nGives VWN5 approximation of the correlation energy density  epsilon_x, and potential V_x.\n\nReferences\n\nS.H. Vosko, L. Wilk, and M. Nusair, Can. J. Phys. 58, 1200 (1980) (doi: 10.1139/p80-159)\n\n\n\n\n\n","category":"function"},{"location":"#Self-consistent-field","page":"AtomEnergyLevels.jl","title":"Self-consistent field","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Due to dependence of the potential V(r) to the solution n(r),  Kohn-Sham equations have to be solved iteratively, until self-consistence  is to be achieved. To facilitate convergence, simple mixing scheme is used.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"n_i+1(r) = (1 - beta) n_i(r) + beta n_i+1","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"# admix density from previous iteration to converge SCF\nρ_in = (1.0 - β) * ρ_in + β * ρ_out","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"SCF is converged if there are no more charge oscillations and energy doesn't change.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"Δρ = 4π * ∫(dx, abs.(ρ_out - ρ_in) .* r²)\n@info @sprintf \"%3i\\t%14.6f\\t%12.6f\\n\" i Etot Δρ\n\n# density converged if there are no more charge oscillations\nΔρ < δn && abs(Etot - E_prev) < δE && break","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"where δn and δE - charge and energy convergence criteria. ","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"As an initial estimate of n(r) for the first SCF cycle, Thomas-Fermi density for neutral atom with nuclear charge Z is provided.","category":"page"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"TF","category":"page"},{"location":"#AtomEnergyLevels.TF","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.TF","text":"TF(r, Z)\n\nApproximate solution of the Thomas-Fermi equation  for neutral atom with nuclear charge Z. Returns density at the distance r.\n\nSee Moliere, G. (1947). Theorie der streuung schneller geladener teilchen i. einzelstreuung am abgeschirmten coulomb-feld. Zeitschrift für Naturforschung A, 2(3), 133-145.\n\nExample\n\nFor a density function rho(r) of N particles the following equation holds.\n\nN = 4piint dr rho(r)r^2\n\nOn the grid r_i = exp(x_i) it is\n\nN = 4piint dx rho(r(x))r^3\n\njulia> x = -30:0.1:20\n-30.0:0.1:20.0\n\njulia> r, n, dx = exp.(x), length(x), step(x);\n\njulia> isapprox(4π * dx * sum(TF.(r, 18) .* r .^3), 18, atol=1e-10)\ntrue\n\n\n\n\n\n","category":"function"},{"location":"#Usage-examples","page":"AtomEnergyLevels.jl","title":"Usage examples","text":"","category":"section"},{"location":"","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.jl","text":"lda","category":"page"},{"location":"#AtomEnergyLevels.lda","page":"AtomEnergyLevels.jl","title":"AtomEnergyLevels.lda","text":"function lda(Z, x = -30.0:0.1:20.0; conf = atomic_electron_configuration[Z],\n             xc = ρ -> LDA_X(ρ) .+ LDA_C_VWN(ρ), Vex = r -> -Z / r,\n             ρ_in = nothing, β = 0.3, δn = 1.0e-6, δE = 5.0e-7, maxit = 100,\n             μ = 1, α = 1e5)\n\nSolve Kohn-Sham DFT Self-Consistent Field equations for an atom using local density approximation (LDA)\n\nOn input:\n\nZ     - nuclear charge\nx     - grid, rᵢ = exp(xᵢ)\nconf  - electronic configuration\nxc    - LDA exchange-correlation functional\nVex   - external potential\nρ_in  - input density (if nothing provided, Thomas-Fermi density is used)\nβ     - density mixing parameter, ρₙ = (1 - β) × ρₙ₋₁ + β × ρₙ\nδn    - density convergence criterion\nδE    - energy convergence criterion\nmaxit - maximum permissible number of SCF iterations\n\nOn output:\n\nlda(...).energy.total - total energy, a.u.\nlda(...).density  - electron density ρ(x) = 1/4π * ∑nᵢ*ψᵢ²(x)\nlda(...).orbitals - matrix, containing complete set of orbitals ψᵢ(x), corresponding eigenvalues εᵢ (energy levels), azimuthal and radial quantum numbers l, nᵣ, and level populations nᵢ (as listed in conf).\n\nExample\n\nHooke atom\n\njulia> lda(2, Vex = r -> 1/8 * r^2, β = 0.8).energy.total;\n[ Info: Using logarithmic 501 point grid with step dx = 0.1000\n[ Info: Using Thomas-Fermi starting electron density\n┌ Info: Starting SCF procedure with density mixing parameter β = 0.8000\n└       and convergence threshold |Δρ| ≤ 1.000000e-06\n[ Info: cycle           energy          |Δρ|\n[ Info:   0           2.103849      1.895566\n[ Info:   1           2.013080      0.357780\n[ Info:   2           2.022087      0.073897\n[ Info:   3           2.025397      0.014779\n[ Info:   4           2.026076      0.003000\n[ Info:   5           2.026201      0.000621\n[ Info:   6           2.026224      0.000130\n[ Info:   7           2.026228      0.000028\n[ Info:   8           2.026229      0.000006\n[ Info:   9           2.026229      0.000001\n[ Info:  10           2.026229      0.000000\n┌ Info: RESULTS SUMMARY:\n│       ELECTRON KINETIC               0.627459\n│       ELECTRON-ELECTRON              1.022579\n│       EXCHANGE-CORRELATION          -0.523773\n│       ELECTRON-NUCLEAR               0.899965\n│       TOTAL ENERGY                   2.026229\n└       VIRIAL RATIO                  -2.229260\n\n\nCompare with exact Kohn-Sham values from Table II of S. Kais et al // Density functionals and dimensional renormalization for an exactly solvable model, JCP 99, 417 (1993); http://dx.doi.org/10.1063/1.465765\n\n        ELECTRON KINETIC               0.6352\n        ELECTRON-ELECTRON              1.0320\n        EXCHANGE-CORRELATION          -0.5553\n        ELECTRON-NUCLEAR               0.8881\n        TOTAL ENERGY                   2.0000\n        VIRIAL RATIO                  -2.1486\n\n\n\n\n\n","category":"function"}]
}
